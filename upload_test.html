<!DOCTYPE html>
<html>

<head>
    <title>Sudip Party Upload</title>
</head>

<body>

    <h2>Upload Party Photo</h2>
    <input type="text" id="guestName" placeholder="Your Name">
    <input type="file" id="fileInput">
    <button onclick="uploadAndSave()">Upload & Save</button>

    <p id="status"></p>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- STEP A: PASTE YOUR COPIED CODE HERE ---
        // (Delete this block and paste the one from your screenshot)
        // const firebaseConfig = {
        //     apiKey: "PASTE_YOUR_API_KEY_FROM_SCREENSHOT_HERE",
        //     authDomain: "sudipparty-24d31.firebaseapp.com",
        //     projectId: "sudipparty-24d31",
        //     storageBucket: "sudipparty-24d31.firebasestorage.app",
        //     messagingSenderId: "272149822964",
        //     appId: "PASTE_YOUR_APP_ID_FROM_SCREENSHOT_HERE"
        // };
        const firebaseConfig = {
                apiKey: "AIzaSyCDuau7j4CyfotHfMr0svnDY8hp10F3f3M",
                authDomain: "sudipparty-24d31.firebaseapp.com",
                projectId: "sudipparty-24d31",
                storageBucket: "sudipparty-24d31.firebasestorage.app",
                messagingSenderId: "372149822854",
                appId: "1:372149822854:web:ca02d0536a604a31703807"
            };
        // -------------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- STEP B: YOUR CLOUDINARY INFO ---
        const cloudName = "duokffn1g";
        const uploadPreset = "sudip_upload";

        window.uploadAndSave = async function () {
            const file = document.getElementById('fileInput').files[0];
            const name = document.getElementById('guestName').value;
            const status = document.getElementById("status");

            if (!file || !name) { alert("Please fill everything!"); return; }

            status.innerText = "Uploading Image...";

            // 1. Send to Cloudinary
            const formData = new FormData();
            formData.append("file", file);
            formData.append("upload_preset", uploadPreset);

            try {
                const response = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
                    method: "POST", body: formData
                });
                const data = await response.json();
                const imageUrl = data.secure_url;

                status.innerText = "Saving to Database...";

                // 2. Save Link to Firebase
                await addDoc(collection(db, "guests"), {
                    name: name,
                    photo: imageUrl,
                    time: new Date()
                });

                status.innerText = "Success! Saved.";
                alert("Upload Complete!");

            } catch (err) {
                console.error(err);
                status.innerText = "Error: " + err.message;
            }
        }
    </script>

</body>

</html>